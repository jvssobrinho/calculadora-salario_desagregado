<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculadora Salarial por Ocupa√ß√£o (PNADc 2025)</title>
    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
        body { background-color: #f0f2f5; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        .card { box-shadow: 0 10px 25px rgba(0,0,0,0.05); border: none; border-radius: 12px; }
        .header-bg { background: linear-gradient(135deg, #2c3e50, #4ca1af); color: white; padding: 3rem 0; margin-bottom: 2rem; }
        
        /* Estilos da Calculadora */
        .result-box { 
            background-color: #ffffff; 
            border: 1px solid #dee2e6;
            border-left: 5px solid #198754;
            border-radius: 8px; 
            padding: 30px; 
            text-align: center; 
            display: none; 
            margin-top: 30px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.05);
            animation: fadeIn 0.6s ease-out;
        }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

        .result-value { font-size: 3.5rem; font-weight: 800; color: #198754; letter-spacing: -1px; margin: 10px 0; }
        .badge-uf { background-color: #e7f1ff; color: #0d6efd; padding: 6px 12px; border-radius: 30px; font-size: 0.9rem; font-weight: 700; text-transform: uppercase; }
        .badge-modelo { background-color: #fff3cd; color: #856404; padding: 5px 10px; border-radius: 20px; font-size: 0.8rem; font-weight: bold; margin-bottom: 10px; display: inline-block; }

        /* Inputs */
        .form-label { font-weight: 600; color: #495057; font-size: 0.9rem; }
        .form-select, .form-control { padding: 12px; border-radius: 8px; border: 1px solid #ced4da; }
        .form-select:focus, .form-control:focus { box-shadow: 0 0 0 0.25rem rgba(13, 110, 253, 0.15); border-color: #86b7fe; }

        /* Bot√£o */
        .btn-calc { padding: 15px; font-size: 1.1rem; font-weight: 700; letter-spacing: 0.5px; text-transform: uppercase; transition: all 0.3s; }
        .btn-calc:hover { transform: translateY(-2px); box-shadow: 0 4px 15px rgba(13, 110, 253, 0.4); }

        footer a { color: inherit; text-decoration: none; border-bottom: 1px dotted #6c757d; }
    </style>
</head>
<body class="d-flex flex-column min-vh-100">

    <div class="header-bg text-center">
        <h1 class="fw-bold display-5">üìä Simulador Salarial de Profiss√µes</h1>
        <p class="lead opacity-75">Baseado na PNAD Cont√≠nua 2025 (Microdados IBGE)</p>
    </div>

    <div class="container pb-5 flex-grow-1">
        
        <div class="row justify-content-center">
            <div class="col-lg-8">
                <div class="card p-4 p-md-5">
                    <form id="salaryForm">
                        <div class="row g-4 mb-4">
                            <div class="col-12"><h5 class="text-primary fw-bold border-bottom pb-2">1. Quem √© voc√™?</h5></div>
                            
                            <div class="col-md-6">
                                <label class="form-label text-danger">Cor / Ra√ßa (Define o Modelo)</label>
                                <select class="form-select border-danger" id="cor" onchange="atualizarDropdownOcupacoes()">
                                    <option value="branca">Branca</option>
                                    <option value="amarela">Amarela (Asi√°tica)</option>
                                    <option value="preta">Preta / Parda</option>
                                    <option value="indigena">Ind√≠gena</option>
                                </select>
                            </div>

                            <div class="col-md-6">
                                <label class="form-label">G√™nero</label>
                                <select class="form-select" id="sexo">
                                    <option value="homem">Homem</option>
                                    <option value="mulher">Mulher</option>
                                </select>
                            </div>

                            <div class="col-md-4">
                                <label class="form-label">Idade</label>
                                <input type="number" class="form-control" id="idade" value="30" min="14" max="80">
                            </div>

                            <div class="col-md-4">
                                <label class="form-label">Escolaridade</label>
                                <select class="form-select" id="estudo">
                                    <option value="0">Sem instru√ß√£o</option>
                                    <option value="4">Fundamental Incompleto</option>
                                    <option value="9">Fundamental Completo</option>
                                    <option value="12" selected>M√©dio Completo</option>
                                    <option value="16">Superior Completo</option>
                                    <option value="18">Mestrado/Doutorado</option>
                                </select>
                            </div>

                            <div class="col-md-4">
                                <label class="form-label">Estado (UF)</label>
                                <select class="form-select" id="uf">
                                    <option value="11">Rond√¥nia</option>
                                    <option value="12">Acre</option>
                                    <option value="13">Amazonas</option>
                                    <option value="14">Roraima</option>
                                    <option value="15">Par√°</option>
                                    <option value="16">Amap√°</option>
                                    <option value="17">Tocantins</option>
                                    <option value="21">Maranh√£o</option>
                                    <option value="22">Piau√≠</option>
                                    <option value="23">Cear√°</option>
                                    <option value="24">Rio G. do Norte</option>
                                    <option value="25">Para√≠ba</option>
                                    <option value="26">Pernambuco</option>
                                    <option value="27">Alagoas</option>
                                    <option value="28">Sergipe</option>
                                    <option value="29">Bahia</option>
                                    <option value="31">Minas Gerais</option>
                                    <option value="32">Esp√≠rito Santo</option>
                                    <option value="33">Rio de Janeiro</option>
                                    <option value="35" selected>S√£o Paulo</option>
                                    <option value="41">Paran√°</option>
                                    <option value="42">Santa Catarina</option>
                                    <option value="43">Rio G. do Sul</option>
                                    <option value="50">Mato G. do Sul</option>
                                    <option value="51">Mato Grosso</option>
                                    <option value="52">Goi√°s</option>
                                    <option value="53">Distrito Federal</option>
                                </select>
                            </div>
                            
                            <div class="col-12"><h5 class="text-primary fw-bold border-bottom pb-2 mt-3">2. Sua Profiss√£o</h5></div>
                            
                            <div class="col-12">
                                <label class="form-label text-success">Ocupa√ß√£o / Cargo (Selecione na lista)</label>
                                <select class="form-select form-select-lg border-success" id="ocupacao">
                                    <option value="" selected disabled>Aguardando carregamento dos dados...</option>
                                </select>
                                <div class="form-text">Dica: Clique na lista e digite as primeiras letras para buscar r√°pido.</div>
                            </div>
                        </div>

                        <div class="d-grid mt-4">
                            <button type="button" class="btn btn-primary btn-calc shadow" onclick="calcularSalario()">Calcular Sal√°rio Estimado</button>
                        </div>
                    </form>

                    <div id="resultado" class="result-box">
                        <span class="badge-modelo" id="infoModelo">...</span><br>
                        <span class="badge-uf" id="badgeProfissao">...</span>
                        <div class="result-value" id="valorEstimado">R$ 0,00</div>
                        <div class="text-muted small">
                            Margem de erro (95%): entre <strong id="faixaMin">R$ 0</strong> e <strong id="faixaMax">R$ 0</strong>
                        </div>
                        <div class="alert alert-light mt-3 small text-start border">
                            <i class="bi bi-info-circle"></i> <strong>Nota Metodol√≥gica:</strong> 
                            O c√°lculo considera uma jornada padr√£o (40h/semanais). O valor reflete a m√©dia de mercado captada pela PNAD para pessoas com seu perfil exato (Idade, Estudo, Regi√£o e Ra√ßa).
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <footer class="mt-auto py-4 bg-white border-top text-center text-secondary">
        <div class="container">
            <p class="mb-0 fw-bold">Projeto de Microeconometria</p>
            <p class="small text-muted">Dados: IBGE/PNADc Fev/2025</p>
        </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        let dadosJSON = null;
        const ARQUIVO_JSON = 'modelo_salario_ocupacao_nomes_reais.json'; // Nome do arquivo gerado pelo Python

        // 1. CARREGAR JSON AO INICIAR
        fetch(ARQUIVO_JSON)
            .then(res => {
                if(!res.ok) throw new Error("Arquivo JSON n√£o encontrado!");
                return res.json();
            })
            .then(data => {
                dadosJSON = data;
                console.log("Dados carregados com sucesso.");
                atualizarDropdownOcupacoes(); // Popula a lista assim que carrega
            })
            .catch(err => {
                alert("Erro cr√≠tico: " + err.message + "\nVerifique se o arquivo .json est√° na mesma pasta.");
                document.getElementById('ocupacao').innerHTML = '<option>Erro ao carregar dados</option>';
            });

        // 2. FUN√á√ÉO PARA POPULAR O DROPDOWN DE OCUPA√á√ïES
        function atualizarDropdownOcupacoes() {
            if (!dadosJSON) return;

            const select = document.getElementById('ocupacao');
            const grupoRaca = document.getElementById('cor').value; // 'branca', 'preta', etc.
            
            // Tenta pegar o modelo da ra√ßa selecionada, se n√£o tiver (ex: amarela as vezes √© pequena), pega da branca como fallback para a lista
            let modeloBase = dadosJSON[grupoRaca] || dadosJSON['branca'];
            
            if (!modeloBase) return;

            // Extrai todas as chaves que come√ßam com "ocup_"
            const coeficientes = modeloBase.coeficientes;
            let listaOcupacoes = [];

            // Adiciona op√ß√£o "Outras / N√£o especificado" (Base)
            listaOcupacoes.push({ valor: "BASE", texto: "OUTRAS / OCUPA√á√ïES ELEMENTARES (BASE)" });

            for (let chave in coeficientes) {
                if (chave.startsWith('ocup_')) {
                    // Formato da chave: "ocup_2231 - M√âDICOS"
                    // Vamos tentar deixar o texto mais limpo para o usu√°rio
                    let textoExibicao = chave.replace('ocup_', ''); 
                    
                    // Se tiver separador " - ", inverte para ficar "NOME (C√ìDIGO)" que √© melhor de ler
                    if (textoExibicao.includes(' - ')) {
                        let partes = textoExibicao.split(' - ');
                        let codigo = partes[0];
                        let nome = partes[1];
                        textoExibicao = `${nome} (C√≥d. ${codigo})`;
                    }

                    listaOcupacoes.push({
                        valor: chave, // A chave original do JSON para usarmos no c√°lculo
                        texto: textoExibicao
                    });
                }
            }

            // Ordena alfabeticamente pelo nome da profiss√£o
            listaOcupacoes.sort((a, b) => a.texto.localeCompare(b.texto));

            // Limpa e preenche o select
            select.innerHTML = '';
            select.disabled = false;
            
            // Adiciona placeholder
            let optDefault = document.createElement('option');
            optDefault.text = "Selecione sua profiss√£o...";
            optDefault.value = "";
            optDefault.disabled = true;
            optDefault.selected = true;
            select.add(optDefault);

            listaOcupacoes.forEach(oc => {
                let opt = document.createElement('option');
                opt.value = oc.valor;
                opt.text = oc.texto;
                select.add(opt);
            });
        }

        // 3. C√ÅLCULO DO SAL√ÅRIO
        function calcularSalario() {
            if (!dadosJSON) return alert("Aguarde, carregando dados...");

            // Coleta Inputs
            const raca = document.getElementById('cor').value;
            const idade = parseFloat(document.getElementById('idade').value);
            const anosEstudo = parseFloat(document.getElementById('estudo').value);
            const sexo = document.getElementById('sexo').value;
            const uf = document.getElementById('uf').value;
            const ocupacaoChave = document.getElementById('ocupacao').value;

            if (!ocupacaoChave) return alert("Por favor, selecione uma profiss√£o.");

            // Pega o modelo correto
            const modelo = dadosJSON[raca];
            if (!modelo) return alert("Dados insuficientes para este grupo racial na amostra.");

            const coef = modelo.coeficientes;
            const meta = modelo.meta;

            // Vari√°veis derivadas
            let experiencia = Math.max(0, idade - anosEstudo - 6);
            let experiencia2 = experiencia * experiencia;

            // --- EQUA√á√ÉO DE MINCER ---
            let lnSalario = coef['Intercepto']; 

            // Adiciona Controles B√°sicos
            if(coef['Anos_Estudo']) lnSalario += coef['Anos_Estudo'] * anosEstudo;
            if(coef['Experiencia']) lnSalario += coef['Experiencia'] * experiencia;
            if(coef['Experiencia_2']) lnSalario += coef['Experiencia_2'] * experiencia2;
            
            if (sexo === 'mulher' && coef['d_mulher']) lnSalario += coef['d_mulher'];
            if (coef[`UF_${uf}`]) lnSalario += coef[`UF_${uf}`];
            if (coef['IMR']) lnSalario += coef['IMR'] * 0.6; // Corre√ß√£o de vi√©s

            // --- ADICIONA O PR√äMIO DA OCUPA√á√ÉO ---
            // Se o usu√°rio escolheu "BASE", n√£o somamos nada (pois √© a refer√™ncia)
            // Se escolheu uma ocupa√ß√£o espec√≠fica, somamos o coeficiente dela
            if (ocupacaoChave !== "BASE") {
                // Verifica se essa ocupa√ß√£o existe especificamente para essa ra√ßa
                // (Pode acontecer de existir na lista geral mas n√£o ter amostra para ind√≠genas, por exemplo)
                if (coef[ocupacaoChave]) {
                    lnSalario += coef[ocupacaoChave];
                } else {
                    console.warn(`A ocupa√ß√£o ${ocupacaoChave} n√£o tem coeficiente para o grupo ${raca}. Usando valor base.`);
                    // Opcional: Avisar o usu√°rio que estamos usando a m√©dia geral
                }
            }

            // Transforma Log -> Reais
            // A constante 180 representa aprox horas mensais (40h sem * 4.5 sem)
            let salarioEstimado = Math.exp(lnSalario) * 180; 
            
            // Intervalo de Confian√ßa (Erro Padr√£o do Modelo)
            // Se o sigma n√£o vier no meta, usamos um padr√£o conservador de 0.65
            let sigma = meta.sigma_log; // Valor padr√£o para Mincer no Brasil
            
            // Limites (95% confian√ßa)
            let min = Math.exp(lnSalario - 1.96 * sigma) * 180;
            let max = Math.exp(lnSalario + 1.96 * sigma) * 180;

            // Atualiza a Interface
            const fmt = new Intl.NumberFormat('pt-BR', { style: 'currency', currency: 'BRL' });
            
            document.getElementById('valorEstimado').innerText = fmt.format(salarioEstimado);
            document.getElementById('faixaMin').innerText = fmt.format(min);
            document.getElementById('faixaMax').innerText = fmt.format(max);
            
            // Textos auxiliares
            const nomesRaca = { 'branca': 'Popula√ß√£o Branca', 'amarela': 'Popula√ß√£o Amarela', 'preta': 'Popula√ß√£o Preta/Parda', 'indigena': 'Popula√ß√£o Ind√≠gena' };
            document.getElementById('infoModelo').innerText = `Modelo Estat√≠stico: ${nomesRaca[raca]} (N=${meta.N})`;
            
            const selOcup = document.getElementById('ocupacao');
            const nomeProfissao = selOcup.options[selOcup.selectedIndex].text.split('(')[0];
            document.getElementById('badgeProfissao').innerText = nomeProfissao; // Mostra nome da profiss√£o no badge

            // Exibe resultado com anima√ß√£o
            const box = document.getElementById('resultado');
            box.style.display = 'block';
            box.scrollIntoView({ behavior: 'smooth' });
        }
    </script>
</body>
</html>
